# 경험치 곡선(XP Curve) 수식 추천 문서

작성일: 2025-12-23  
목적: 레벨업에 필요한 경험치(또는 누적 경험치)를 계산하는 **추천 수식(Formula)** 과 **운영 규칙**을 정리한다.  
대상: Firestore 데이터(예: `levelCurves`, `xpFormulas`)에 넣을 “공식 정의 문서”.

---

## 1) 용어/전제

- **L (Level)**: 레벨. 기본 가정은 **1부터 시작** (정책이 다르면 반드시 문서/코드에서 통일)
- **xp(L)**: 레벨 L에 도달(또는 L→L+1 업)하기 위해 필요한 **요구 XP(단일 구간 XP)**  
- **TotalXp(L)**: 레벨 1부터 L까지 도달하는 데 필요한 **누적 XP**
- XP는 운영상 혼선 방지를 위해 **정수**로 통일한다.

### 1.1 반올림 규칙(필수로 1개를 선택해 통일)
- 권장: `ceil()` (항상 올림 → “필요 XP가 예상보다 적게 나오는” 사고 방지)
- 대안: `round()` 또는 `floor()` (선택 시 전 구간 동일하게 적용)

---

## 2) 추천 수식 1순위: POWER (거듭제곱)

### 2.1 공식
- **단일 구간 XP**
  - `xp(L) = ceil(A * (L^P) + B)`
- **누적 XP(참고)**
  - `TotalXp(L) = Σ_{k=1..L-1} xp(k)`  *(“L에 도달” 기준이면 L-1까지 합)*

### 2.2 파라미터 의미
- `A` : 성장 스케일(전체 난이도)
- `P` : 성장 곡률(후반 가속 정도). **P가 클수록** 후반이 가파름
- `B` : 기본 오프셋(초반 바닥값 확보)

### 2.3 추천 기본값(출발점 예시)
- 일반 캐주얼/성장형: `A=50, P=1.6, B=0`
- 후반을 더 빡세게: `P=1.8~2.2` 범위에서 조정
- 초반 최소 XP 보장: `B=20~100` 부여

### 2.4 장점/주의점
- 장점: 튜닝이 직관적, 대부분의 레벨 시스템에 잘 맞음
- 주의: `P`를 너무 키우면 후반이 “벽”이 된다 → 미리보기 필수

---

## 3) 추천 수식 2순위: PIECEWISE (구간별 수식)

운영에서 가장 많이 쓰이는 실전형.  
“초반은 빠르게, 중반은 안정적으로, 후반은 길게” 같은 의도를 **구간별로 명확히** 반영 가능.

### 3.1 공식(형태)
- 구간 세그먼트 정의:  
  - 예: `S1: L=1..10`, `S2: L=11..30`, `S3: L=31..100`
- 각 구간별로 수식 적용:
  - `xp(L) = xp_Si(L)`  *(L이 속한 구간 i의 수식)*

### 3.2 구간별로 추천하는 조합
- S1(초반): `LINEAR` 또는 낮은 `POWER(P~1.2)`
- S2(중반): `POWER(P~1.5~1.8)`
- S3(후반): `POWER(P~1.8~2.2)` 또는 `LOGISTIC`로 완화

### 3.3 운영 체크(필수)
- 구간이 **겹치지 않아야** 함
- 구간 사이 경계에서 XP가 급락/급등하지 않도록 경고(툴에서 자동 검사)

---

## 4) 추천 수식 3순위: EXPONENTIAL (지수)

### 4.1 공식
- `xp(L) = ceil(A * (R^(L-1)) + B)`

### 4.2 파라미터 의미
- `A` : 시작 스케일
- `R` : 증가율(예: 1.03, 1.06, 1.10 …)
- `B` : 오프셋

### 4.3 장점/주의점
- 장점: 후반 가속을 강하게 만들기 좋음
- 치명적 주의: `R`이 조금만 커져도 후반이 폭발적으로 증가 → 반드시 미리보기/상한/완화 필요

---

## 5) 보조 옵션: LINEAR (선형)

### 5.1 공식
- `xp(L) = ceil(m * L + b)`

### 5.2 사용처
- 매우 짧은 구간(튜토리얼/초반)에서 의도대로 만들기 쉬움
- 전체 커브로 쓰면 후반이 심심해질 수 있음

---

## 6) 후반 완화형: LOGISTIC (S-curve)

후반을 “무한히 증가”시키지 않고 **완만하게 수렴/포화**시키고 싶을 때 사용.

### 6.1 공식(예시 형태)
- `xp(L) = ceil( K / (1 + exp(-r*(L - L0))) + B )`

### 6.2 파라미터
- `K` : 포화 상한(최대 근처)
- `r` : 기울기(변화 속도)
- `L0` : 중심 레벨(가속 전환점)
- `B` : 오프셋

### 6.3 주의점
- 파라미터 직관성이 POWER보다 떨어짐
- 툴에서 그래프 미리보기가 없으면 운영 튜닝이 어려움

---

## 7) 가장 안전한 방법: TABLE (레벨별 명시 테이블)

### 7.1 형태
- `xp(1)=100, xp(2)=120, xp(3)=150 ...` 처럼 **레벨별 값을 직접 저장**

### 7.2 장점/단점
- 장점: 의도 100% 반영, 예측 가능
- 단점: 데이터 양 증가, 수정 비용 증가  
  → PIECEWISE + 구간별 파라미터로 대부분 대체 가능

---

## 8) 운영 권장 규칙(강력 권장)

- 모든 curve는 저장 전 **샘플 레벨 미리보기**를 해야 한다:
  - 최소: L=1..50  
  - 권장: L=1..maxLevel
- 이상치 경고:
  - `xp(L) <= 0` 금지
  - 증가율이 비정상(예: 전 레벨 대비 2배 이상 반복) 경고
  - NaN/Infinity 발생 즉시 차단
- 큰 변경은 기존 curve를 덮어쓰기보다:
  - 새 `curveId` 생성 + 기존은 `deprecated` 태그로 유지(롤백/추적에 유리)

---

## 9) 예시 파라미터 세트(JSON)

### 9.1 POWER 예시
```json
{
  "type": "POWER",
  "params": { "A": 50, "P": 1.6, "B": 0 },
  "rounding": "CEIL",
  "expression": "ceil(A * (L^P) + B)"
}
```

### 9.2 PIECEWISE 예시
```json
{
  "type": "PIECEWISE",
  "params": {
    "segments": [
      { "minL": 1, "maxL": 10, "type": "LINEAR", "params": { "m": 20, "b": 0 } },
      { "minL": 11, "maxL": 30, "type": "POWER", "params": { "A": 30, "P": 1.4, "B": 0 } },
      { "minL": 31, "maxL": 200, "type": "POWER", "params": { "A": 50, "P": 1.8, "B": 0 } }
    ]
  },
  "rounding": "CEIL"
}
```

---

## 10) 빠른 선택 가이드

- 대부분의 레벨 시스템: **POWER**
- 구간 난이도 설계가 중요: **PIECEWISE**
- 후반 가속이 핵심(주의 필요): **EXPONENTIAL**
- 후반을 포화시키고 싶다: **LOGISTIC**
- 값이 절대 정확해야 한다(이벤트/스테이지): **TABLE**

